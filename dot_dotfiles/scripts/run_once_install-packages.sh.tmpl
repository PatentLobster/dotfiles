#!/bin/sh
{{ if eq .chezmoi.os "darwin" }}
# macOS-specific code

brew bundle --no-lock --file=/dev/stdin <<EOF

tap "homebrew/cask"
tap "homebrew/cask-fonts"
tap "homebrew/cask-versions"
tap "homebrew/bundle"

brew "tmux"
brew "go"
brew "pv"
brew "bat"
brew "jq"
brew "fd"
brew "fzf"
brew "thefuck"
brew "btop"
brew "node"
brew "yarn"
brew "tldr"
brew "zsh-syntax-highlighting"
brew "grep"
brew "svn"
brew "lolcat"
brew "awscli"
brew "coreutils"
brew "ffmpeg"
brew "gnupg"
brew "git"
brew "wget"
brew "zoxide"
brew "lsd"
brew "fselect"

cask "spectacle"
cask "alfred"

cask "vlc"

cask "github"
cask "transmit"
cask "sublime-text"
cask "gpg-suite"

cask "sequel-ace"
cask "beekeeper-studio"
cask "tableplus"

cask "font-lato"
cask "font-open-sans"
cask "font-roboto"
cask "font-source-code-pro-for-powerline"
cask "font-source-code-pro"
cask "font-source-sans-pro"
cask "font-source-serif-pro"
cask "font-hack-nerd-font"
EOF

{{ else if eq .chezmoi.os "linux" }}
{{   if eq .chezmoi.osRelease.id "debian" }}
# Debian-specific code

/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
sudo apt update
sudo apt install wget curl tmux zsh zoxide python3-dev python3-pip python3-setuptools
brew install thefuck

get_latest_release() {
  curl --silent "https://api.github.com/repos/$1/releases/latest" | # Get latest release from GitHub api
    grep '"tag_name":' |                                            # Get tag line
    sed -E 's/.*"([^"]+)".*/\1/'                                    # Pluck JSON value
}

{{      if eq .chezmoi.arch "amd64" }}
wget https://github.com/Peltoche/lsd/releases/download/$(get_latest_release "Peltoche/lsd")/lsd-musl_$(get_latest_release "Peltoche/lsd")_amd64.deb -O /tmp/lsd.deb
{{      else }}
wget https://github.com/Peltoche/lsd/releases/download/$(get_latest_release "Peltoche/lsd")/lsd-musl_$(get_latest_release "Peltoche/lsd")_arm64.deb -O /tmp/lsd.deb
{{      end }}

sudo dpkg -i /tmp/lsd.deb




{{   else if eq .chezmoi.osRelease.id "fedora" }}
# Fedora-specific code
sudo dnf install zsh zoxide lsd
brew install thefuck

{{   end }}
{{ end }}
